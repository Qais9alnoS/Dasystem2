# مكونات الإدارة المالية - Finance Management Components

## نظرة عامة

هذا المجلد يحتوي على جميع المكونات الخاصة بنظام الإدارة المالية للمدرسة، والمخصص لدور "المسؤول المالي" (Finance Officer).

## البنية العامة

### الصفحة الرئيسية
- **FinanceManagerPage.tsx**: الصفحة الرئيسية التي تحتوي على 3 تبويبات (الصندوق، الطلاب، اختيار السنة)

### الأقسام الثلاثة
1. **TreasurySection.tsx**: قسم الصندوق
   - عرض ملخص مالي للمدرسة (صافي الربح، الديون المستحقة للمدرسة، الديون المستحقة على المدرسة)
   - عرض الكاردات المالية (نشاطات، طلاب، كاردات مخصصة)
   - فلاتر للبحث والتصنيف
   - إمكانية إضافة كاردات جديدة

2. **StudentsFinanceSection.tsx**: قسم الطلاب
   - فلاتر حسب (الصف، الشعبة، الفترة - نهاري/مسائي)
   - استيراد الطلاب من قاعدة البيانات
   - عرض الطلاب ككاردات مرتبة أبجدياً
   - إحصائيات (عدد الطلاب، عدد الطلاب ذوي الديون، إجمالي الديون)

3. **YearSelectionSection.tsx**: قسم اختيار السنة
   - اختيار السنة الدراسية (للعرض فقط، لا تعديل)
   - وصول سريع للسنوات الحديثة

### المكونات الأساسية

#### الكاردات
- **FinanceCard.tsx**: كارد مالي عام (للنشاطات والكاردات المخصصة)
  - عرض نوع الكارد (دخل، خرج، دخل وخرج)
  - عرض المدخولات والمصروفات
  - عرض الصافي
  - تحذير بالمعاملات غير المكتملة

- **StudentFinanceCard.tsx**: كارد طالب مالي
  - عرض اسم الطالب ومعلوماته الأساسية (ولي الأمر، الهاتف)
  - عرض الصف والشعبة والفترة
  - عرض الرصيد والمبلغ المدفوع/المطلوب

#### النوافذ المنبثقة (Modals)

- **StudentFinanceDetailModal.tsx**: تفاصيل مالية للطالب
  - إضافة تسديد (مبلغ، تاريخ، رقم أمر قبض)
  - الإجمالي المسدد
  - تفاصيل الأقساط (قسط باص، قسط مدرسي) مع الحسومات (ثابتة أو نسبة مئوية)
  - إيرادات أخرى (لباس، دورات، أخرى) - حقول متعددة قابلة للتعديل
  - الرصيد الجزئي (الرصيد الحالي للسنة)
  - ملاحظات الدفع
  - الرصيد الكلي (مع السنوات السابقة)
  - زر لعرض تاريخ الأرصدة

- **FinanceCardDetailModal.tsx**: تفاصيل الكارد المالي
  - ملخص مالي (دخل مكتمل، خرج مكتمل، الصافي، غير مكتمل)
  - إضافة معاملة مالية (دخل/خرج، مبلغ، تاريخ، وصف، مسؤول، حالة)
  - سجل المعاملات مع إمكانية تمييزها كمكتملة
  - فلترة وترتيب المعاملات

- **AddFinanceCardModal.tsx**: إضافة كارد مالي جديد
  - اسم الكارد
  - نوع الكارد (دخل، خرج، دخل وخرج)
  - التفاصيل

- **BalanceHistoryModal.tsx**: تاريخ أرصدة الطالب
  - عرض الرصيد الكلي
  - عرض تفاصيل كل سنة (المبلغ المطلوب، المبلغ المدفوع، الرصيد)
  - تصنيف الأرصدة (دين للمدرسة، دين على المدرسة، متساوي)

## الميزات الرئيسية

### 1. نظام الحسومات المتقدم
- حسم ثابت (مبلغ محدد)
- حسم نسبة مئوية (يتم الحساب تلقائياً)
- سبب الحسم (حقل اختياري)

### 2. الإيرادات الأخرى المتعددة
- نوع اللباس + مبلغ اللباس
- نوع الدورة + مبلغ الدورة
- حقول إضافية قابلة للتوسع

### 3. نظام ترحيل الأرصدة التلقائي
- يتم ترحيل الأرصدة غير المكتملة من سنة لأخرى تلقائياً
- عرض تفصيلي لكل سنة عند الضغط على الرصيد الكلي

### 4. الكاردات المالية المرنة
- كاردات افتراضية (نشاطات، طلاب)
- كاردات مخصصة يمكن إضافتها
- تصنيف حسب النوع (دخل، خرج، دخل وخرج)

### 5. حالة المعاملات
- معاملات مكتملة (تم الدفع/الاستلام)
- معاملات معلقة (لم يتم الدفع/الاستلام بعد)
- إمكانية تحديث الحالة

## التصميم

- تم اتباع نمط iOS Design System كما هو محدد في `IOS-Style-example.tsx`
- استخدام المكونات من `@/components/ui`
- تصميم responsive يعمل على جميع الأحجام
- ألوان متناسقة مع بقية التطبيق

## API Integration

جميع المكونات متصلة بـ Backend عبر:
- `financeManagerApi` من `@/services/api.ts`
- `academicYearApi` لاختيار السنة

## الصلاحيات

- يمكن الوصول للصفحة بدور: `finance` أو `director`
- محمية عبر `ProtectedRoute` في `App.tsx`

## التوجيه (Routing)

- الصفحة الرئيسية: `/finance`
- مضافة في `App.tsx` و `Sidebar.tsx`

## الاستخدام

```tsx
import { FinanceManagerPage } from '@/components/finance';

// في App.tsx
<Route 
  path="finance" 
  element={
    <ProtectedRoute allowedRoles={['finance', 'director']} fallback={<AccessDenied />}>
      <FinanceManagerPage />
    </ProtectedRoute>
  } 
/>
```

## الصيانة والتطوير المستقبلي

### نقاط التحسين المحتملة
1. إضافة تقارير مالية (تصدير PDF/Excel)
2. إضافة رسوم بيانية للإحصائيات
3. إضافة نظام إشعارات للديون المستحقة
4. إضافة تنبيهات للمدفوعات القادمة
5. إضافة نظام طباعة الإيصالات

### ملاحظات للمطورين
- تأكد من اختبار جميع الحسابات (الحسومات، الأرصدة، الترحيل)
- راجع صلاحيات المستخدمين قبل إضافة ميزات جديدة
- حافظ على تناسق التصميم مع باقي المكونات
- استخدم الـ TypeScript types المحددة في `@/types/school.ts`

## المساهمة

عند إضافة ميزات جديدة:
1. اتبع نمط التصميم الموجود
2. أضف التوثيق المناسب
3. اختبر مع أدوار المستخدمين المختلفة
4. تأكد من التكامل مع Backend

---

**آخر تحديث**: 2025-11-03
**الإصدار**: 1.0.0

